{"ast":null,"code":"import _regeneratorRuntime from\"/Users/samsamaei/Documents/Projects/falcon/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/samsamaei/Documents/Projects/falcon/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/samsamaei/Documents/Projects/falcon/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useReducer}from\"react\";import AuthContext from\"./authContext\";import authReducer from\"./AuthReducer\";import interceptorForAxios from\"../../Components/Tools/setAuthToken\";import axios from\"axios\";import{SERVER_URL}from\"../constant\";import{USER_LOADED,AUTH_ERROR,LOGIN_SUCCESS,SET_AUTH_HEADER,LOGIN_FAIL,LOGOUT,CLEAR_ERRORS}from\"../types\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthState=function AuthState(props){interceptorForAxios();var initialState={token:localStorage.getItem(\"accessToken\"),isAuthenticated:localStorage.getItem(\"isAuthenticated\"),loading:localStorage.getItem(\"loading\"),user:localStorage.getItem(\"user\")?JSON.parse(localStorage.getItem(\"user\")):null,error:localStorage.getItem(\"error\")};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// Load User\nvar loadUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(\"t11\",// localStorage.getItem(\"token\"),\nlocalStorage.token);// await setAuthToken(localStorage.token);\n_context.prev=1;_context.next=4;return axios.get(SERVER_URL+\"/auth\");case 4:res=_context.sent;console.log(\"auth data res\",res.data);_context.next=8;return dispatch({type:USER_LOADED,payload:res.data});case 8:_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);dispatch({type:AUTH_ERROR});case 13:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return function loadUser(){return _ref.apply(this,arguments);};}();var setAuthHeader=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(DATA){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return dispatch({type:SET_AUTH_HEADER,payload:DATA});case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function setAuthHeader(_x){return _ref2.apply(this,arguments);};}();var login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(formData){var config,res;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// setAuthToken(localStorage.token);\nconfig={headers:{\"Content-Type\":\"application/json\"}};_context3.prev=1;_context3.next=4;return axios.post(SERVER_URL+\"/login\",formData,config);case 4:res=_context3.sent;// console.log(\"login:\", res.data);\ndispatch({type:LOGIN_SUCCESS,payload:res.data});_context3.next=8;return loadUser();case 8:loadUser();_context3.next=15;break;case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](1);console.log(\"loginerror:\",_context3.t0);dispatch({type:LOGIN_FAIL,payload:_context3.t0.response});case 15:case\"end\":return _context3.stop();}}},_callee3,null,[[1,11]]);}));return function login(_x2){return _ref3.apply(this,arguments);};}();var logout=function logout(){return dispatch({type:LOGOUT});};// Clear Errors\nvar clearErrors=function clearErrors(){return dispatch({type:CLEAR_ERRORS});};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{token:state.token,isAuthenticated:state.isAuthenticated,loading:state.loading,user:state.user,error:state.error,loadUser:loadUser,login:login,logout:logout,clearErrors:clearErrors},children:props.children});};export default AuthState;","map":{"version":3,"names":["React","useReducer","AuthContext","authReducer","interceptorForAxios","axios","SERVER_URL","USER_LOADED","AUTH_ERROR","LOGIN_SUCCESS","SET_AUTH_HEADER","LOGIN_FAIL","LOGOUT","CLEAR_ERRORS","AuthState","props","initialState","token","localStorage","getItem","isAuthenticated","loading","user","JSON","parse","error","state","dispatch","loadUser","console","log","get","res","data","type","payload","setAuthHeader","DATA","login","formData","config","headers","post","response","logout","clearErrors","children"],"sources":["/Users/samsamaei/Documents/Projects/falcon/src/Context/Auth/authState.js"],"sourcesContent":["import React, { useReducer } from \"react\";\r\nimport AuthContext from \"./authContext\";\r\nimport authReducer from \"./AuthReducer\";\r\nimport interceptorForAxios from \"../../Components/Tools/setAuthToken\";\r\nimport axios from \"axios\";\r\nimport { SERVER_URL } from \"../constant\";\r\n\r\nimport {\r\n  USER_LOADED,\r\n  AUTH_ERROR,\r\n  LOGIN_SUCCESS,\r\n  SET_AUTH_HEADER,\r\n  LOGIN_FAIL,\r\n  LOGOUT,\r\n  CLEAR_ERRORS,\r\n} from \"../types\";\r\n\r\nconst AuthState = (props) => {\r\n  interceptorForAxios();\r\n  const initialState = {\r\n    token: localStorage.getItem(\"accessToken\"),\r\n    isAuthenticated: localStorage.getItem(\"isAuthenticated\"),\r\n    loading: localStorage.getItem(\"loading\"),\r\n    user: localStorage.getItem(\"user\")\r\n      ? JSON.parse(localStorage.getItem(\"user\"))\r\n      : null,\r\n    error: localStorage.getItem(\"error\"),\r\n  };\r\n\r\n  const [state, dispatch] = useReducer(authReducer, initialState);\r\n\r\n  // Load User\r\n  const loadUser = async () => {\r\n    console.log(\r\n      \"t11\",\r\n      // localStorage.getItem(\"token\"),\r\n      localStorage.token\r\n    );\r\n\r\n    // await setAuthToken(localStorage.token);\r\n    try {\r\n      const res = await axios.get(SERVER_URL + \"/auth\");\r\n      console.log(\"auth data res\", res.data);\r\n      await dispatch({\r\n        type: USER_LOADED,\r\n        payload: res.data,\r\n      });\r\n    } catch (err) {\r\n      dispatch({ type: AUTH_ERROR });\r\n    }\r\n  };\r\n\r\n  const setAuthHeader = async (DATA) => {\r\n    await dispatch({\r\n      type: SET_AUTH_HEADER,\r\n      payload: DATA,\r\n    });\r\n  };\r\n\r\n  const login = async (formData) => {\r\n    // setAuthToken(localStorage.token);\r\n    const config = {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    };\r\n\r\n    try {\r\n      const res = await axios.post(SERVER_URL + \"/login\", formData, config);\r\n      // console.log(\"login:\", res.data);\r\n      dispatch({\r\n        type: LOGIN_SUCCESS,\r\n        payload: res.data,\r\n      });\r\n      await loadUser();\r\n      loadUser();\r\n    } catch (err) {\r\n      console.log(\"loginerror:\", err);\r\n      dispatch({\r\n        type: LOGIN_FAIL,\r\n        payload: err.response,\r\n      });\r\n    }\r\n  };\r\n\r\n  const logout = () => dispatch({ type: LOGOUT });\r\n\r\n  // Clear Errors\r\n  const clearErrors = () => dispatch({ type: CLEAR_ERRORS });\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        token: state.token,\r\n        isAuthenticated: state.isAuthenticated,\r\n        loading: state.loading,\r\n        user: state.user,\r\n        error: state.error,\r\n\r\n        loadUser,\r\n\r\n        login,\r\n        logout,\r\n        clearErrors,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthState;\r\n"],"mappings":"gZAAA,MAAOA,MAAP,EAAgBC,UAAhB,KAAkC,OAAlC,CACA,MAAOC,YAAP,KAAwB,eAAxB,CACA,MAAOC,YAAP,KAAwB,eAAxB,CACA,MAAOC,oBAAP,KAAgC,qCAAhC,CACA,MAAOC,MAAP,KAAkB,OAAlB,CACA,OAASC,UAAT,KAA2B,aAA3B,CAEA,OACEC,WADF,CAEEC,UAFF,CAGEC,aAHF,CAIEC,eAJF,CAKEC,UALF,CAMEC,MANF,CAOEC,YAPF,KAQO,UARP,C,2CAUA,GAAMC,UAAS,CAAG,QAAZA,UAAY,CAACC,KAAD,CAAW,CAC3BX,mBAAmB,GACnB,GAAMY,aAAY,CAAG,CACnBC,KAAK,CAAEC,YAAY,CAACC,OAAb,CAAqB,aAArB,CADY,CAEnBC,eAAe,CAAEF,YAAY,CAACC,OAAb,CAAqB,iBAArB,CAFE,CAGnBE,OAAO,CAAEH,YAAY,CAACC,OAAb,CAAqB,SAArB,CAHU,CAInBG,IAAI,CAAEJ,YAAY,CAACC,OAAb,CAAqB,MAArB,EACFI,IAAI,CAACC,KAAL,CAAWN,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAX,CADE,CAEF,IANe,CAOnBM,KAAK,CAAEP,YAAY,CAACC,OAAb,CAAqB,OAArB,CAPY,CAArB,CAUA,gBAA0BlB,UAAU,CAACE,WAAD,CAAca,YAAd,CAApC,4CAAOU,KAAP,iBAAcC,QAAd,iBAEA;AACA,GAAMC,SAAQ,4FAAG,6IACfC,OAAO,CAACC,GAAR,CACE,KADF,CAEE;AACAZ,YAAY,CAACD,KAHf,EAMA;AAPe,sCASKZ,MAAK,CAAC0B,GAAN,CAAUzB,UAAU,CAAG,OAAvB,CATL,QASP0B,GATO,eAUbH,OAAO,CAACC,GAAR,CAAY,eAAZ,CAA6BE,GAAG,CAACC,IAAjC,EAVa,sBAWPN,SAAQ,CAAC,CACbO,IAAI,CAAE3B,WADO,CAEb4B,OAAO,CAAEH,GAAG,CAACC,IAFA,CAAD,CAXD,yFAgBbN,QAAQ,CAAC,CAAEO,IAAI,CAAE1B,UAAR,CAAD,CAAR,CAhBa,qEAAH,kBAARoB,SAAQ,0CAAd,CAoBA,GAAMQ,cAAa,6FAAG,kBAAOC,IAAP,+IACdV,SAAQ,CAAC,CACbO,IAAI,CAAExB,eADO,CAEbyB,OAAO,CAAEE,IAFI,CAAD,CADM,yDAAH,kBAAbD,cAAa,6CAAnB,CAOA,GAAME,MAAK,6FAAG,kBAAOC,QAAP,uIACZ;AACMC,MAFM,CAEG,CACbC,OAAO,CAAE,CACP,eAAgB,kBADT,CADI,CAFH,yCASQpC,MAAK,CAACqC,IAAN,CAAWpC,UAAU,CAAG,QAAxB,CAAkCiC,QAAlC,CAA4CC,MAA5C,CATR,QASJR,GATI,gBAUV;AACAL,QAAQ,CAAC,CACPO,IAAI,CAAEzB,aADC,CAEP0B,OAAO,CAAEH,GAAG,CAACC,IAFN,CAAD,CAAR,CAXU,uBAeJL,SAAQ,EAfJ,QAgBVA,QAAQ,GAhBE,qFAkBVC,OAAO,CAACC,GAAR,CAAY,aAAZ,eACAH,QAAQ,CAAC,CACPO,IAAI,CAAEvB,UADC,CAEPwB,OAAO,CAAE,aAAIQ,QAFN,CAAD,CAAR,CAnBU,uEAAH,kBAALL,MAAK,8CAAX,CA0BA,GAAMM,OAAM,CAAG,QAATA,OAAS,SAAMjB,SAAQ,CAAC,CAAEO,IAAI,CAAEtB,MAAR,CAAD,CAAd,EAAf,CAEA;AACA,GAAMiC,YAAW,CAAG,QAAdA,YAAc,SAAMlB,SAAQ,CAAC,CAAEO,IAAI,CAAErB,YAAR,CAAD,CAAd,EAApB,CAEA,mBACE,KAAC,WAAD,CAAa,QAAb,EACE,KAAK,CAAE,CACLI,KAAK,CAAES,KAAK,CAACT,KADR,CAELG,eAAe,CAAEM,KAAK,CAACN,eAFlB,CAGLC,OAAO,CAAEK,KAAK,CAACL,OAHV,CAILC,IAAI,CAAEI,KAAK,CAACJ,IAJP,CAKLG,KAAK,CAAEC,KAAK,CAACD,KALR,CAOLG,QAAQ,CAARA,QAPK,CASLU,KAAK,CAALA,KATK,CAULM,MAAM,CAANA,MAVK,CAWLC,WAAW,CAAXA,WAXK,CADT,UAeG9B,KAAK,CAAC+B,QAfT,EADF,CAmBD,CA5FD,CA8FA,cAAehC,UAAf"},"metadata":{},"sourceType":"module"}